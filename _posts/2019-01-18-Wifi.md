---
layout: post
title: Wifi Defense & Exploitation
subtitle: DC509 workshop
gh-repo: fancy-sauce/fancy-sauce.github.io
gh-badge: [star, follow]
tags: [wifi, wpa2, wep, linux]
comments: true
---

Welcome to a little explanation of what I've learned so far in wifi exploitation and defense. The first task is to understand the access points and devices that communicate via 802.11. For this reconaissance we will use a few tools such as wigle.net which can look up access points and determine their origin on a map. With these applications and skills we will put it into effect by gaining access to hotel wifi. This helps a lot if your unwilling to give the captive portals at many hotel chains your personal information. We can gain access to points that are a little more secure, using tools that can break the security of most access points in use today. All too commonly, routers are configured to use mac address filtering, which later is proven a false sense of security to wireless networks. Finally, just for fun we can disconnect everyone from a particular access point, forcing them to reconnect or log back in. All of these attacks are to understand common attacks and defend against them.

A lot of the post is going to cover tools that can be found installed by default in Kali, so using that system is going to make your life a lot easier.

## Setting up
---
Installation of Kali would be the easiest and most straightforward setup to get going. This tutorial covers tools that can be found installed by default in Kali, so using that system is going to make your life a lot easier. Next would be a Kali VM with a usb wifi adapter plugged in. If you can't do any of those options or have a linux distro you can't be without, install this package list:

```
sudo apt update
sudo apt install kismet, airmon-ng, mdk3, tcpdump
git clone https://github.com/derv82/wifite2.git
```

 Also, your going to need a 2.4ghz wireless adapter capable of injecting packets. These are some that I've used with great results and they range from $10-$30.

[Panda PAU05](https://www.amazon.com/Panda-300Mbps-Wireless-USB-Adapter/dp/B00EQT0YK2)

[Panda PAU06](https://www.amazon.com/Panda-Wireless-PAU06-300Mbps-Adapter/dp/B00JDVRCI0/ref=sr_1_3?keywords=panda+pau06&qid=1579729676&s=electronics&sr=1-3)

[Alfa AWUS036NH](https://www.amazon.com/Alfa-AWUSO36NH-Wireless-Long-Rang-Network/dp/B0035APGP6/ref=sr_1_8?crid=JM1TERTNGJR8&keywords=alfa+awus036nha&qid=1579729704&s=electronics&sprefix=alfa+%2Celectronics%2C232&sr=1-8)

## Attacking WEP

WEP cracking is something that is trivial, but for some reason not so much when setting up on our test router using [ddwrt](https://www.dd-wrt.com). The router takes the configuration but clients cannot connect to it. So for this, I'm going to just go over the theory of this attack. First we boot up wifite and run it against DC509-1:
```
wifite -WEP
```
After running this for a bit near a WEP point it will start to populate in the list. Quit the scan using ```ctrl+c``` and enter the number associated with the target access point. Wifite will then start working through the available attack scripts in its toolbox. With a weak password and a client connected to the access point you'll catch enough IV's (initialization vectors) to crack the AP's password. In our lab test we set up an access point using a password from the rockyou wordlist and cracked it in seconds.

## Attacking WPA2



## Bypassing MAC address filtering

## Finding our targets

[Kismet](https://www.kismetwireless.net) describes itself as "a wireless network and device detector, sniffer, wardriving tool, and WIDS (wireless intrusion detection) framework."

It's awesome at detecting common attacks, but even better at displaying information about wireless devices and networks. In our case we will use it to discover hidden access points and view connected devices to those access points.

Using kismet, we will look at the access points available around us. The more powerful our wireless adapter & antenna, the more data we will capture in the air. (Quality Yagi antennas tailored to 802.11 are awesome)

{: .box-warning}
**Notice:**
If your having trouble with Kismet, this [Discord Server](https://discord.gg/5N4ME9a) is the quickest way to get help and the community is very helpful and welcoming.

These tools don't start monitor mode on our adapter as nicely as wifite does, so we have to set it up manually.
```
airodump -ng start wlan0
```
Replace wlan0 with your interface adapter

{: .box-warning}
**Warning:** Check your adapter name with ```ifconfig``` Also, you might need to bring your interface down first, run airmon-ng, then start it back up for it to work properly. Airmon-ng renames monitor mode interfaces by appending "mon" to the original interface name.

```
ifconfig wlan0 down
airmon-ng start wlan0
ifconfig wlan0mon up
```

Running Kismet is as easy as typing ```kismet -i wlan0mon```

This starts the webserver automatically and is located at ```127.0.0.1:2501``` just put this into your browser.

We can check our login creds with:
```
cat ~username/.kismet/kismet_httpd.conf
```
 Once logged in, go here
 ![Menu1](https://raw.githubusercontent.com/fancy-sauce/fancy-sauce.github.io/master/img/kismet_menu.png)

Then select "Data Sources"
![Menu2](https://raw.githubusercontent.com/fancy-sauce/fancy-sauce.github.io/master/img/kismet_menu2.png)

It may take a moment for all interfaces to show up click on the "Available Interface" dropdown for your device and select "Enable Source"

Because we are in monitor mode, we can see packets going from other access points, not just the ones sent from the wireless point we are connected to normally. The data from users to the AP is still encrypted, but we can see the devices connected to the points, what channels they broadcast on, what the mac address for that AP is and other metadata. The cool thing about this is we can see "hidden" access points as well.

Locating vulnerable access points is pretty easy. We can leverage the power of crowd data collection. [Wigle.net](https://www.wigle.net) is a service that collects information about access points and adds them to a database we can search and perform queries on. Tools to build this awesome data service can be as simple as an Android device, to an all-out wardriving rig. I've build these setups in the past using a gps module, raspberry pi, alfa card, and a portable battery pack. It's not nearly as easy to get data into Wigle this way, but you do have more control over what information gets to them, such as your (super basic) device information. Android device are great for this because they come with everything and installation is quick from the Google Play Store.

Anyways, jump onto the site and register for an account. Once that is done, login and go to "View" in the top menu. Then "Advanced Search". Finally, lets search for all WEP "encryption status" APs in Chicago. Stale information isn't going to help us as most of the WEP points are gone nowadays, so lets filter by the last year by entering the "last observed" info. Easy, right?

{: .box-warning}
**Notice:**
The time/date format is: YYYYMMDDHHMMSS
Don't go hunting for someones access point to exploit, this is just proof this can happen. Don't use WEP!

Boom, these are all the extremely vulnerable access points that MAY still exist and a simple Wigle scan would verify this.
